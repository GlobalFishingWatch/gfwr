<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Making maps with `gfwr` • gfwr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Making maps with `gfwr`">
<!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-WXTMN69');</script><!-- End Google Tag Manager -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    <!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WXTMN69" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <!-- inserted before the package title in the header ->
    <a class="navbar-brand me-2" href="../index.html">gfwr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.4</small>

    <!-- inserted before the navbar links -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/identity.html">Using get_vessel_info(): the basics of vessel identity in Global Fishing Watch and gfwr</a></li>
    <li><a class="dropdown-item" href="../articles/making-maps.html">Making maps with `gfwr`</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GlobalFishingWatch/gfwr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>

    <!-- inserted after the navbar links -->
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Making maps with `gfwr`</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/GlobalFishingWatch/gfwr/blob/HEAD/vignettes/articles/making-maps.Rmd" class="external-link"><code>vignettes/articles/making-maps.Rmd</code></a></small>
      <div class="d-none name"><code>making-maps.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>A powerful feature of <code>gfwr</code> is the ability to get data
for making custom maps of human activity at sea, such as apparent
fishing effort, at-sea transshipment, and port visits. The
<code><a href="../reference/get_raster.html">get_raster()</a></code> function provides gridded (e.g. raster) data
from GFW’s <a href="https://globalfishingwatch.org/our-apis/documentation#map-visualization-4wings-api" class="external-link">4Wings
Map Visualization API</a> and is useful for making heatmaps, while the
<code><a href="../reference/get_event.html">get_event()</a></code> function supplies vector data (mostly point
locations) from the GFW <a href="https://globalfishingwatch.org/our-apis/documentation#events-api" class="external-link">Events
API</a> for individual vessel events.</p>
<blockquote>
<p>This vignette demonstrates how to use and combine multiple
<code>gfwr</code> functions to make a variety of maps of fishing vessel
activity. Specifically, this vignette will show how to use the
<code><a href="../reference/get_raster.html">get_raster()</a></code> function to make heatmaps of apparent fishing
effort, and the <code><a href="../reference/get_event.html">get_event()</a></code> function to visualize the
locations of specific events. It will demonstrate how to request data
for specific regions using <code>gfwr</code>’s built-in options, as well
as how to use a custom region provided by the user.</p>
</blockquote>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>To get started, first load the <code>gfwr</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GlobalFishingWatch/gfwr" class="external-link">gfwr</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">gfwr</span></span></span></code></pre>
<p>Make sure your API key is set up in your <code>.Renviron</code> file
(see the <a href="#authorization">Authorization</a> section of the
<code>gfwr</code> README)</p>
<p>For this vignette, we’ll also use some <code>tidyverse</code>
packages for data wrangling and plotting, as well as <code>sf</code> for
creating and manipulating spatial data and <code>rnaturalearth</code> to
add reference data to our maps.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/" class="external-link">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearthdata/" class="external-link">rnaturalearthdata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/" class="external-link">glue</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>To make our maps a little nicer, let’s define a custom
<code>ggplot2</code> theme and a color palette for our heatmaps of
apparent fishing effort.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Map theme with dark background</span></span>
<span><span class="va">map_theme</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.box <span class="op">=</span> <span class="st">"vertical"</span>, </span>
<span>    legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">3</span>, <span class="st">"mm"</span><span class="op">)</span>, </span>
<span>    legend.key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">20</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#848b9b"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, </span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, color <span class="op">=</span> <span class="st">"#363c4c"</span>, size <span class="op">=</span> <span class="fl">8</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, color <span class="op">=</span> <span class="st">"#363c4c"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, </span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#363c4c"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, </span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#848b9b"</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Palette for fishing activity</span></span>
<span><span class="va">map_effort_light</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#ffffff"</span>, <span class="st">"#eeff00"</span>, <span class="st">"#3b9088"</span>,<span class="st">"#0c276c"</span><span class="op">)</span></span></code></pre></div>
<p>We’ll also define a common date range to use for querying data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">'2021-01-01'</span></span>
<span><span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">'2021-03-31'</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="making-heatmaps-of-apparent-fishing-effort-with-get_raster">Making heatmaps of apparent fishing effort with
<code>get_raster()</code><a class="anchor" aria-label="anchor" href="#making-heatmaps-of-apparent-fishing-effort-with-get_raster"></a>
</h2>
<p>The <code>gfwr</code> function <code><a href="../reference/get_raster.html">get_raster()</a></code> provides
aggregated gridded (e.g. raster) data for AIS-based apparent fishing
effort. It was designed to provide data for a specific region, offering
users the ability to select from multiple built-in region types by
specifying a specific Exclusive Economic Zone (EEZ), Marine Protected
Area (MPA), or Regional Fisheries Management Organization (RFMO).</p>
<p>The list of available regions for each type, and their
<code>label</code> and <code>id</code>, can be accessed with the
<code><a href="../reference/get_regions.html">get_regions()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eez_regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_regions.html">get_regions</a></span><span class="op">(</span>region_source <span class="op">=</span> <span class="st">'EEZ'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eez_regions</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 285 × 5</span></span></span>
<span><span class="co">#&gt;    iso   label                          id GEONAME                      POL_TYPE</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ASM   American Samoa               <span style="text-decoration: underline;">8</span>444 United States Exclusive Eco… 200NM   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> SHN   Ascension                    <span style="text-decoration: underline;">8</span>379 British Exclusive Economic … 200NM   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> COK   Cook Islands                 <span style="text-decoration: underline;">8</span>446 New Zealand Exclusive Econo… 200NM   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> FLK   Falkland / Malvinas Islands  <span style="text-decoration: underline;">8</span>389 Overlapping claim Falkland … Overlap…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PYF   French Polynesia             <span style="text-decoration: underline;">8</span>440 French Exclusive Economic Z… 200NM   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PCN   Pitcairn                     <span style="text-decoration: underline;">8</span>439 British Exclusive Economic … 200NM   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> SHN   Saint Helena                 <span style="text-decoration: underline;">8</span>380 British Exclusive Economic … 200NM   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> WSM   Samoa                        <span style="text-decoration: underline;">8</span>445 Samoan Exclusive Economic Z… 200NM   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> TON   Tonga                        <span style="text-decoration: underline;">8</span>448 Tongan Exclusive Economic Z… 200NM   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> SHN   Tristan da Cunha             <span style="text-decoration: underline;">8</span>382 British Exclusive Economic … 200NM   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 275 more rows</span></span></span></code></pre></div>
<p><code>gfwr</code> also includes the <code><a href="../reference/get_region_id.html">get_region_id()</a></code>
function to get the <code>label</code> and <code>id</code> for a
specific region using the <code>region_name</code> argument. For EEZs,
the <code>region_name</code> corresponds to the ISO3 code. Note that,
for some countries, the ISO3 code will return multiple regions. For
RFMOs, <code>region_name</code> corresponds to the RFMO abbreviation
(e.g. <code>"ICCAT"</code>) and for MPAs it refers to the full name of
the MPA. The <code><a href="../reference/get_region_id.html">get_region_id()</a></code> function also works in
reverse. If a region <code>id</code> is passed as a <code>numeric</code>
to the function as the <code>region_name</code>, the corresponding
region <code>label</code> can be returned. This is especially useful
when events are returned with region ids and you want the more
descriptive label. See <a href="https://globalfishingwatch.org/faqs/reference-layer-sources/" class="external-link">here</a>
for more information about the regions used by GFW.</p>
<p>Let’s start by making a map of apparent fishing effort in the Italian
EEZ. The <code><a href="../reference/get_raster.html">get_raster()</a></code> function requires we provide the
<code>id</code> of a specific region (or a shapefile, but more on that
later). We could look up the Italian EEZ <code>id</code> in the
<code>eez_regions</code> table we just created, but let’s use
<code><a href="../reference/get_region_id.html">get_region_id()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use get_region_id function to get EEZ code for Italy</span></span>
<span><span class="va">ita_eez_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_region_id.html">get_region_id</a></span><span class="op">(</span>region_name <span class="op">=</span> <span class="st">"ITA"</span>, region_source <span class="op">=</span> <span class="st">"EEZ"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   iso3  label    id GEONAME                         POL_TYPE</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ITA   Italy  <span style="text-decoration: underline;">5</span>682 Italian Exclusive Economic Zone 200NM</span></span></code></pre>
<p>The <code><a href="../reference/get_raster.html">get_raster()</a></code> function allows users to specify
multiple criteria to customize the data they download, including the
date range, spatial and temporal resolution, and grouping variables. See
the documentation for <code><a href="../reference/get_raster.html">get_raster()</a></code> or the <a href="https://globalfishingwatch.org/our-apis/documentation#report-url-parameters-for-both-post-and-get-requests" class="external-link">GFW
APIs</a> for more info about these parameter options.</p>
<p>In this case, let’s request data during our time range at 100th
degree resolution and grouped by flag State:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download data for the Italian EEZ</span></span>
<span><span class="va">eez_fish_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_raster.html">get_raster</a></span><span class="op">(</span></span>
<span>  spatial_resolution <span class="op">=</span> <span class="st">"HIGH"</span>,</span>
<span>  temporal_resolution <span class="op">=</span> <span class="st">"YEARLY"</span>,</span>
<span>  group_by <span class="op">=</span> <span class="st">"FLAG"</span>,</span>
<span>  start_date <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>  end_date <span class="op">=</span> <span class="va">end_date</span>,</span>
<span>  region <span class="op">=</span> <span class="va">ita_eez_code</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  region_source <span class="op">=</span> <span class="st">"EEZ"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 69,557 × 6</span></span></span>
<span><span class="co">#&gt;      Lat   Lon `Time Range` flag  `Vessel IDs` `Apparent Fishing Hours`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  43.7  13.6         <span style="text-decoration: underline;">2</span>021 ITA              3                     4.92</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  42.2  15.7         <span style="text-decoration: underline;">2</span>021 ITA             10                     9.23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  40.9  13.9         <span style="text-decoration: underline;">2</span>021 ITA              9                    21.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  41.9  16.6         <span style="text-decoration: underline;">2</span>021 ITA              2                     3.14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  36.1  13           <span style="text-decoration: underline;">2</span>021 ITA              1                     1.12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  41.0  18.1         <span style="text-decoration: underline;">2</span>021 ITA              2                     2.82</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  43.7  14.1         <span style="text-decoration: underline;">2</span>021 ITA              3                     6.46</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  42.4  14.9         <span style="text-decoration: underline;">2</span>021 ITA              3                     5.56</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  45.2  12.4         <span style="text-decoration: underline;">2</span>021 ITA              1                     0.17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  42.3  10.6         <span style="text-decoration: underline;">2</span>021 ITA              1                     0.77</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 69,547 more rows</span></span></span></code></pre>
<p>Because the data includes fishing by all flag states, to make a map
of all activity, we first need to summarize activity by grid cell.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eez_fish_all_df</span> <span class="op">&lt;-</span> <span class="va">eez_fish_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Lat</span>, <span class="va">Lon</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>fishing_hours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">`Apparent Fishing Hours`</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'Lat'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span></code></pre></div>
<p>Now we can use <code>ggplot2</code> to plot the data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eez_fish_all_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fishing_hours</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lon</span>,</span>
<span>                y <span class="op">=</span> <span class="va">Lat</span>,</span>
<span>                fill <span class="op">=</span> <span class="va">fishing_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>returnclass <span class="op">=</span> <span class="st">"sf"</span>, scale <span class="op">=</span> <span class="st">"medium"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">eez_fish_all_df</span><span class="op">$</span><span class="va">Lon</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">eez_fish_all_df</span><span class="op">$</span><span class="va">Lon</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">eez_fish_all_df</span><span class="op">$</span><span class="va">Lat</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">eez_fish_all_df</span><span class="op">$</span><span class="va">Lat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>    trans <span class="op">=</span> <span class="st">'log10'</span>,</span>
<span>    colors <span class="op">=</span> <span class="va">map_effort_light</span>, </span>
<span>    na.value <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Apparent fishing hours in the Italian EEZ"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{start_date} to {end_date}"</span><span class="op">)</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Fishing hours"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">map_theme</span></span></code></pre></div>
<p><img src="making-maps_files/figure-html/ita_plot-1.png" alt="A map of apparent fishing effort in the Italian EEZ.  The scale is logarithmic and the fishing effort is concentrated around ports along the Adriatic and the Tyrrhenian Seas and the southern coast of Sicily" width="90%" style="display: block; margin: auto;"></p>
<p>As another example, let’s request low resolution apparent fishing
effort data within the jurisdiction of the Indian Ocean Tuna Commission
(IOTC), grouped yearly by gear type:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download data for the IOTC</span></span>
<span><span class="va">iotc_fish_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_raster.html">get_raster</a></span><span class="op">(</span></span>
<span>  spatial_resolution <span class="op">=</span> <span class="st">"LOW"</span>,</span>
<span>  temporal_resolution <span class="op">=</span> <span class="st">"YEARLY"</span>,</span>
<span>  group_by <span class="op">=</span> <span class="st">"GEARTYPE"</span>,</span>
<span>  start_date <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>  end_date <span class="op">=</span> <span class="va">end_date</span>,</span>
<span>  region <span class="op">=</span> <span class="st">"IOTC"</span>,</span>
<span>  region_source <span class="op">=</span> <span class="st">"RFMO"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 106,054 × 6</span></span></span>
<span><span class="co">#&gt;      Lat   Lon `Time Range` geartype         `Vessel IDs` Apparent Fishing Hou…¹</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  -<span style="color: #BB0000;">7.6</span>  47.8         <span style="text-decoration: underline;">2</span>021 drifting_longli…            8                  38.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  -<span style="color: #BB0000;">8</span>    79.8         <span style="text-decoration: underline;">2</span>021 drifting_longli…            2                   5.72</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> -<span style="color: #BB0000;">36.4</span> 137.          <span style="text-decoration: underline;">2</span>021 inconclusive                5                  19.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  -<span style="color: #BB0000;">9</span>    65.6         <span style="text-decoration: underline;">2</span>021 drifting_longli…            1                   0.27</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  -<span style="color: #BB0000;">7.1</span>  40.9         <span style="text-decoration: underline;">2</span>021 drifting_longli…            1                   1.49</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  -<span style="color: #BB0000;">7.9</span>  54           <span style="text-decoration: underline;">2</span>021 drifting_longli…            4                   7.33</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  26.1  52.6         <span style="text-decoration: underline;">2</span>021 fishing                     2                  11.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> -<span style="color: #BB0000;">36.2</span>  42.9         <span style="text-decoration: underline;">2</span>021 drifting_longli…            1                   2.51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  -<span style="color: #BB0000;">7.2</span>  45.7         <span style="text-decoration: underline;">2</span>021 drifting_longli…            6                  15.7 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  -<span style="color: #BB0000;">5.2</span>  47.4         <span style="text-decoration: underline;">2</span>021 drifting_longli…            6                  16.0 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 106,044 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​`Apparent Fishing Hours`</span></span></span></code></pre>
<p>This time, instead of aggregating all activity, let’s plot the
activity of a specific gear type:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iotc_p1</span> <span class="op">&lt;-</span> <span class="va">iotc_fish_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">geartype</span> <span class="op">==</span> <span class="st">'drifting_longlines'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`Apparent Fishing Hours`</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lon</span>,</span>
<span>                y <span class="op">=</span> <span class="va">Lat</span>,</span>
<span>                fill <span class="op">=</span> <span class="va">`Apparent Fishing Hours`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>returnclass <span class="op">=</span> <span class="st">"sf"</span>, scale <span class="op">=</span> <span class="st">"medium"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">iotc_fish_df</span><span class="op">$</span><span class="va">Lon</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">iotc_fish_df</span><span class="op">$</span><span class="va">Lon</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">iotc_fish_df</span><span class="op">$</span><span class="va">Lat</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">iotc_fish_df</span><span class="op">$</span><span class="va">Lat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>    transform <span class="op">=</span> <span class="st">'log10'</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span>,<span class="fl">100</span><span class="op">)</span>,</span>
<span>    colors <span class="op">=</span> <span class="va">map_effort_light</span>, </span>
<span>    na.value <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/comma.html" class="external-link">comma</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Apparent fishing hours in the IOTC by drifting longlines"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{start_date} to {end_date}"</span><span class="op">)</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Fishing hours"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">map_theme</span></span>
<span> </span>
<span><span class="va">iotc_p1</span> </span></code></pre></div>
<p><img src="making-maps_files/figure-html/iotc_raster-1.png" alt="A map of apparent fishing hours in the IOTC RFMO by drifting longlines. " width="90%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="when-your-api-request-times-out">When your API request times out<a class="anchor" aria-label="anchor" href="#when-your-api-request-times-out"></a>
</h3>
<p>For API performance reasons, the <code><a href="../reference/get_raster.html">get_raster()</a></code> function
restricts individual queries to a single year of data. However, even
with this restriction, it is possible for API request to time out before
it completes. When this occurs, the initial <code><a href="../reference/get_raster.html">get_raster()</a></code>
call will return an error, and subsequent API requests using any
<code>gfwr</code> <code>get_</code> function will return an HTTP 429
error until the original request completes:</p>
<blockquote>
<p>Error in <code><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">httr2::req_perform()</a></code>: ! HTTP 429 Too Many
Requests. • Your application token is not currently enabled to perform
more than one concurrent report. If you need to generate more than one
report concurrently, contact us at <a href="mailto:apis@globalfishingwatch.org" class="email">apis@globalfishingwatch.org</a></p>
</blockquote>
<p>Although no data was received, the request is still being processed
by the APIs and will become available when it completes. To account for
this, <code>gfwr</code> includes the <code><a href="../reference/get_last_report.html">get_last_report()</a></code>
function, which let’s users request the results of their last API
request with <code><a href="../reference/get_raster.html">get_raster()</a></code>.</p>
<p>The <code><a href="../reference/get_last_report.html">get_last_report()</a></code> function will tell you if the APIs
are still processing your request and will download the results if the
request has finished successfully. You will receive an error message if
the request finished but resulted in an error or if it’s been &gt;30
minutes since the last report was generated using
<code><a href="../reference/get_raster.html">get_raster()</a></code>. For more information, see the <a href="https://globalfishingwatch.org/our-apis/documentation#get-last-report-generated" class="external-link">Get
last report generated endpoint</a> documentation on the GFW API
page.</p>
<p>If you’re struggling with this issue, we suggest breaking your
request into smaller individual requests and then binding the results in
R.</p>
</div>
</div>
<div class="section level2">
<h2 id="plotting-vessel-events">Plotting vessel events<a class="anchor" aria-label="anchor" href="#plotting-vessel-events"></a>
</h2>
<p>The <code><a href="../reference/get_event.html">get_event()</a></code> function provides spatial data about the
location of specific vessel activities. There are currently five
available event types
(<code>"FISHING"</code>,<code>"ENCOUNTER"</code>,<code>"LOITERING"</code>,
<code>"PORT VISIT"</code>, and <code>"GAP"</code>) and the
<code>vessel-types</code> argument allow users to request events for
different categories of vessels (e.g. <code>"FISHING"</code>,
<code>"CARRIER"</code>, <code>"CARGO"</code>, etc.). There are also a
few event-specific arguments for specifying things like encounter types
and confidence levels. For more details, see the
<code><a href="../reference/get_event.html">get_event()</a></code> function documentation and the <a href="https://globalfishingwatch.org/our-apis/documentation#data-caveat" class="external-link">GFW
API documentation</a>.</p>
<p>In this example, we will use <code><a href="../reference/get_event.html">get_event()</a></code> to request
encounter events between fishing vessels and refrigerated carrier
vessels. We’ll restrict events to those within the jurisdiction of the
Indian Ocean Tuna Commission (IOTC) using the <code>region</code> and
<code>region_source</code> arguments like we did in the previous
example.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using same example as above</span></span>
<span><span class="va">encounters_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_event.html">get_event</a></span><span class="op">(</span>event_type <span class="op">=</span> <span class="st">"ENCOUNTER"</span>,</span>
<span>                           encounter_types <span class="op">=</span> <span class="st">"CARRIER-FISHING"</span>,</span>
<span>                           start_date <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>                           end_date <span class="op">=</span> <span class="va">end_date</span>,</span>
<span>                           region <span class="op">=</span> <span class="st">"IOTC"</span>,</span>
<span>                           region_source <span class="op">=</span> <span class="st">"RFMO"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "Downloading 182 events from GFW"</span></span></code></pre></div>
<p>Encounters events have two rows per event to represent both vessels.
Because each row shares the same event ID (<code>eventId</code>), we can
extract the <code>eventId</code> and select one row per
<code>eventId</code> to remove duplicate positions. We’ll also use the
<code>lon</code> and <code>lat</code> coordinates to create a
<code>sf</code> object for each encounter event.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">encounters_sf_df</span> <span class="op">&lt;-</span> <span class="va">encounters_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">eventId</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eventId"</span>,<span class="st">"vessel_number"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">vessel_number</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">eventId</span>, <span class="va">eventType</span>, <span class="va">geometry</span><span class="op">)</span></span></code></pre></div>
<p>To assist with plotting, let’s get the bounding box of the encounter
events.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">enc_bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">encounters_sf_df</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s add the encounters layer to our previous map of drifting
longline effort in the IOTC and use the bounding box to restrict the
plot to the area with encounters.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iotc_p1</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">encounters_sf_df</span>, </span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">eventType</span><span class="op">)</span>, </span>
<span>          alpha <span class="op">=</span> <span class="fl">0.7</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="va">enc_bbox</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>           ylim <span class="op">=</span> <span class="va">enc_bbox</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Apparent fishing hours in the IOTC by drifting longlines and fishing vessel encounter events with carrier vessels'</span>,</span>
<span>       color <span class="op">=</span> <span class="st">'Event type'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Coordinate system already present. Adding new coordinate system, which will</span></span>
<span><span class="co">#&gt; replace the existing one.</span></span></code></pre></div>
<p><img src="making-maps_files/figure-html/iotc_plot_1-1.png" alt="A map of apparent fishing hours in the IOTC by drifting longlines and  fishing vessels encounters" width="90%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="making-maps-for-custom-regions">Making maps for custom regions<a class="anchor" aria-label="anchor" href="#making-maps-for-custom-regions"></a>
</h2>
<p>The <code><a href="../reference/get_raster.html">get_raster()</a></code> and <code><a href="../reference/get_event.html">get_event()</a></code> functions
also allow users to download data within a custom region by providing a
GeoJSON polygon. To facilitate this, the <code><a href="../reference/get_raster.html">get_raster()</a></code> and
<code><a href="../reference/get_event.html">get_event()</a></code> functions allow users to pass a <code>sf</code>
object to the <code>region</code> argument.</p>
<p>To demonstrate this, we’ll first create a tibble of coordinates
defining an arbitrary polygon and convert to an <code>sf</code>
object.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_shp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  lon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">96</span>,<span class="op">-</span><span class="fl">96</span>,<span class="op">-</span><span class="fl">66</span>,<span class="op">-</span><span class="fl">66</span>,<span class="op">-</span><span class="fl">96</span><span class="op">)</span>,</span>
<span>  lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">24</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="op">-</span><span class="fl">24</span>,<span class="op">-</span><span class="fl">24</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_combine</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span></span></code></pre></div>
<p>Plot the <code>sf</code> object to confirm it was created
successfully.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>returnclass <span class="op">=</span> <span class="st">"sf"</span>, scale <span class="op">=</span> <span class="st">"small"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">my_shp</span>, </span>
<span>    fill <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>    color <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">map_theme</span></span></code></pre></div>
<p><img src="making-maps_files/figure-html/plot_shp-1.png" alt="A world map with all countries and a red bounding box in the area surrounding  Ecuador, Peru and the north of Chile. " width="90%" style="display: block; margin: auto;"></p>
<p>Let’s create a <code>sf</code> bounding box object for our region to
use for plotting later. Although our shape is a simple rectangle in this
example, this is helpful when using more complex regions.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_shp_bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">my_shp</span><span class="op">)</span></span></code></pre></div>
<p>Now we’re ready to request data in our custom region from
<code><a href="../reference/get_raster.html">get_raster()</a></code> and <code><a href="../reference/get_event.html">get_event()</a></code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_raster_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_raster.html">get_raster</a></span><span class="op">(</span></span>
<span>  spatial_resolution <span class="op">=</span> <span class="st">"LOW"</span>,</span>
<span>  temporal_resolution <span class="op">=</span> <span class="st">"YEARLY"</span>,</span>
<span>  group_by <span class="op">=</span> <span class="st">"GEARTYPE"</span>,</span>
<span>  start_date <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>  end_date <span class="op">=</span> <span class="va">end_date</span>,</span>
<span>  region <span class="op">=</span> <span class="va">my_shp</span>,</span>
<span>  region_source <span class="op">=</span> <span class="st">"USER_SHAPEFILE"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>For events, we’ll request high-confidence port visits by fishing
vessels</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_port_events_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_event.html">get_event</a></span><span class="op">(</span>event_type <span class="op">=</span> <span class="st">"PORT_VISIT"</span>,</span>
<span>                          confidences <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                          vessel_types <span class="op">=</span> <span class="st">"FISHING"</span>,</span>
<span>                          start_date <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>                          end_date <span class="op">=</span> <span class="va">end_date</span>,</span>
<span>                          region <span class="op">=</span> <span class="va">my_shp</span>,</span>
<span>                          region_source <span class="op">=</span> <span class="st">"USER_SHAPEFILE"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "Downloading 4119 events from GFW"</span></span></code></pre></div>
<p>and loitering events by refrigerated cargo vessels</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_loitering_events_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_event.html">get_event</a></span><span class="op">(</span>event_type <span class="op">=</span> <span class="st">"LOITERING"</span>,</span>
<span>                                    vessel_types <span class="op">=</span> <span class="st">"CARRIER"</span>,</span>
<span>                                    start_date <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>                                    end_date <span class="op">=</span> <span class="va">end_date</span>,</span>
<span>                                    region <span class="op">=</span> <span class="va">my_shp</span>,</span>
<span>                                    region_source <span class="op">=</span> <span class="st">"USER_SHAPEFILE"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "Downloading 50 events from GFW"</span></span></code></pre></div>
<p>As before, let’s summarize the raster to plot all fishing activity by
fishing vessels</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_raster_all_df</span> <span class="op">&lt;-</span> <span class="va">my_raster_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Lat</span>, <span class="va">Lon</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>fishing_hours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">`Apparent Fishing Hours`</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'Lat'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span></code></pre></div>
<p>and combine our two event datasets and create <code>sf</code> objects
for each event.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_events_sf</span> <span class="op">&lt;-</span> <span class="va">my_port_events_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">eventId</span>, <span class="va">lon</span>, <span class="va">lat</span>, <span class="va">eventType</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">my_loitering_events_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">eventId</span>, <span class="va">lon</span>, <span class="va">lat</span>, <span class="va">eventType</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">eventId</span>, <span class="va">eventType</span>, <span class="va">geometry</span><span class="op">)</span></span></code></pre></div>
<p>Finally, let’s plot the fishing effort raster and overlay the
loitering events and port visits.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_raster_all_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">fishing_hours</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lon</span>,</span>
<span>                y <span class="op">=</span> <span class="va">Lat</span>,</span>
<span>                fill <span class="op">=</span> <span class="va">fishing_hours</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">my_events_sf</span>,</span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">eventType</span><span class="op">)</span>,</span>
<span>          alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>returnclass <span class="op">=</span> <span class="st">'sf'</span>, scale <span class="op">=</span> <span class="st">'medium'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="va">my_shp_bbox</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span>,</span>
<span>           ylim <span class="op">=</span> <span class="va">my_shp_bbox</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>    transform <span class="op">=</span> <span class="st">'log10'</span>,</span>
<span>    colors <span class="op">=</span> <span class="va">map_effort_light</span>, </span>
<span>    na.value <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">'Fishing hours, loitering events, and port visits'</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{start_date} to {end_date}"</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">'Fishing hours'</span>,</span>
<span>    color <span class="op">=</span> <span class="st">'Event type'</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">map_theme</span></span></code></pre></div>
<p><img src="making-maps_files/figure-html/loitering_ports_fishing_map-1.png" alt="Apparent fishing hours in the area of interest around Ecuador, Peru and the  north of Chile, in yellow, red dots indicating loitering events and blue dots indicating port visits." width="90%" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tyler Clavelle, Rocío Joo, Nate Miller, Andrea Sánchez-Tapia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>



  <!-- inserted at the end of the body -->

  </body>
</html>
