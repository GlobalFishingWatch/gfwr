---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# gfwr

<!-- badges: start -->
<!-- badges: end -->

<!-- Add link to API documentation page once it's ready-->

The `gfwr` R package is a simple wrapper for the Global Fishing Watch (GFW) [APIs](). 
It provides convenient functions to pull GFW data directly into R in tidy formats.

The package currently works with the following APIs:

* Vessel API: vessel search and identity based on AIS self reported data
* Events API: encounters, loitering, port visits and fishing events based on AIS data
* Map Visualization (4Wings API): apparent fishing effort based on AIS data


## Installation

You can install the development version of gfwr like so:

``` r
devtools::install_github("GlobalFishingWatch/gfwr")
```

## Authorization

The use of `gfwr` requires a GFW API token, which users can request from the [GFW API Portal](). Save this token to your `.Renviron` file as a string called `"GFW_TOKEN"`. Then use `Sys.getenv("GFW_TOKEN")` and save the information in an object in your R workspace every time you need to extract the token and pass it to subsequent `gfwr` functions.

So you can do:


```{r example, eval=F}
key <- Sys.getenv("GFW_TOKEN")
```


## Vessels API

The `get_vessel_info` function allows you to get vessel identity details. 
There are three search types: `basic`, `advanced`, and `id`.

* `basic` search takes features like MMSI, IMO, callsign, shipname as inputs and 
identifies all vessels in the specified dataset that match
* `advanced` search allows for the use of fuzzy matching with terms such as LIKE. The `id` search allows the user to search using a GFW vessel
* `id` allows the user to specify the `vessel id` (generated by GFW)

The user can also specify which identity databases to use: `carrier_vessel`, 
`support_vessel`, `fishing_vessel`, or `all`. With the latter, all databases are used for the search. 
This is generally recommended and is the option set by default. 


### Examples

To get information of a vessel with MMSI = 224224000:

```{r example_vessel_info_1, eval=F}
get_vessel_info(query = 224224000, search_type = "basic", 
                dataset = "support_vessel", key = key)
```

To combine different fields and do fuzzy matching:

```{r example_vessel_info_2, eval=F}
get_vessel_info(query = "shipname LIKE '%GABU REEFE%' OR imo = '8300949'", 
                search_type = "advanced", dataset = "carrier_vessel", key = key)
```

To specify a `vessel id`:

```{r example_vessel_info_3, eval=F}
get_vessel_info(query = "8c7304226-6c71-edbe-0b63-c246734b3c01", 
                search_type = "id")
```

To specify more than one `vessel id`:

```{r example_vessel_info_4, eval=F}
get_vessel_info(query = 
                  "8c7304226-6c71-edbe-0b63-c246734b3c01,
                6583c51e3-3626-5638-866a-f47c3bc7ef7c,
                71e7da672-2451-17da-b239-857831602eca", 
                search_type = 'id')
```


## Events API

The `get_event` function allows you to get data from vessel activities such as: 
[apparent fishing events](), [encounters](), [loitering](), and [port visits]().

<!-- I don't think we have tested loitering, or encounters yet-->


<!-- #' Base function to get event from API and convert response to data frame -->
<!-- #' -->
<!-- #' @param event_type Type of event to get data of. It can be "port_visit" or "fishing" -->
<!-- #' @param vessel VesselID. How to get this? -->
<!-- #' @param include_regions Whether to include regions? Ask engineering if this can always be false -->
<!-- #' @param start_date Start of date range to search events -->
<!-- #' @param end_date End of date range to search events -->
<!-- #' @param key Authorization token. Can be obtained with gfw_auth function -->

### Examples


## Map Visualization API 


